@startuml system_architecture
!theme plain

title System Architecture Overview - POS Microservices

skinparam rectangle {
    BackgroundColor<<frontend>> LightBlue
    BackgroundColor<<service>> LightGreen
    BackgroundColor<<database>> LightYellow
}

skinparam actor {
    BackgroundColor LightPink
}

actor "User" as user <<person>>

rectangle "Frontend Layer" <<frontend>> {
    component "React Frontend\n:3000\nReact/TypeScript/Vite" as frontend
}

rectangle "Microservices Layer" <<service>> {
    component "EventManager\n:12345\nGo/Gin" as eventmgr
    component "User Service\n:12346\nGo/Gin" as usersvc
    component "IDM Service\n:50051\nGo/gRPC" as idm
    component "IDM Gateway\n:8000\nPython/FastAPI" as idmgw
}

rectangle "Data Layer" <<database>> {
    database "Event Database\nPostgreSQL\nevent_db" as eventdb
    database "User Database\nMongoDB\nuser_db" as userdb
    database "IDM Database\nPostgreSQL\nidm_db" as idmdb
    database "Redis Cache\nBlacklist" as redis
}

user --> frontend : Uses\nHTTPS

frontend --> eventmgr : API calls\nHTTP/REST
frontend --> usersvc : API calls\nHTTP/REST
frontend --> idmgw : Auth requests\nHTTP/REST

eventmgr --> idm : Verify tokens\ngRPC
usersvc --> idm : Verify tokens\ngRPC
usersvc --> eventmgr : Create tickets\nHTTP
idmgw --> idm : Forward auth\ngRPC

eventmgr --> eventdb : Reads/Writes\nSQL
usersvc --> userdb : Reads/Writes\nMongoDB
idm --> idmdb : Reads/Writes\nSQL
idm --> redis : Cache tokens\nRedis Protocol

note right of eventmgr
  Manages:
  - Events
  - Event Packets
  - Tickets
end note

note right of usersvc
  Manages:
  - User Profiles
  - Social Media Links
  - User Tickets
end note

note right of idm
  Central Auth:
  - JWT Tokens
  - Token Verification
  - Token Blacklist
end note

note right of idmgw
  HTTP to gRPC
  Adapter
end note

@enduml
