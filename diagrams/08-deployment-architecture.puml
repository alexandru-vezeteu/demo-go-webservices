@startuml deployment
!theme plain

node "Docker Host" {

    package "pos-network (Bridge)" {

        node "Frontend Container" {
            component [React App\nVite Dev Server\n:3000] as Frontend
        }

        node "EventManager Container" {
            component [Go Application\nGin Server\n:8080] as EventMgr
        }

        node "User Service Container" {
            component [Go Application\nGin Server\n:12346] as UserSvc
        }

        node "IDM Gateway Container" {
            component [Python Application\nFastAPI/Uvicorn\n:8000] as IDMGateway
        }
    }

    package "event-network (Bridge)" {
        node "EventManager Container" as EventMgrNet

        node "Event PostgreSQL Container" {
            database [PostgreSQL 16\nPort: 5432\nDB: event_db] as EventDB
        }
    }

    package "user-network (Bridge)" {
        node "User Service Container" as UserSvcNet

        node "MongoDB Container" {
            database [MongoDB Latest\nPort: 27017\nDB: user_db] as MongoDB
        }
    }

    package "idm-network (Bridge)" {
        node "IDM Service Container" {
            component [Go Application\ngRPC Server\n:50051] as IDM
        }

        node "IDM Gateway Container" as IDMGWNet

        node "IDM PostgreSQL Container" {
            database [PostgreSQL 16\nPort: 5432\nDB: idm_db] as IDMDB
        }

        node "Redis Container" {
            database [Redis 7\nPort: 6379\nBlacklist Cache] as Redis
        }
    }

    cloud "Host Machine" {
        actor [Developer/User] as User
    }

    User --> Frontend : http://localhost:3000

    Frontend --> EventMgr : HTTP REST\nlocalhost:8080
    Frontend --> UserSvc : HTTP REST\nlocalhost:12346
    Frontend --> IDMGateway : HTTP REST\nlocalhost:8000

    EventMgr --> IDM : gRPC\nidm:50051
    UserSvc --> IDM : gRPC\nidm:50051
    UserSvc --> EventMgr : HTTP\neventmanager:8080
    IDMGateway --> IDM : gRPC\nidm:50051

    EventMgrNet --> EventDB : SQL\nevent-postgres:5432
    UserSvcNet --> MongoDB : MongoDB\nuser-mongo:27017
    IDM --> IDMDB : SQL\nidm-postgres:5432
    IDM --> Redis : Redis Protocol\nredis:6379

    note right of Frontend
        Volume: ./frontend/src
        Hot reload enabled
    end note

    note right of EventMgr
        Build: ./EventManager/app.dockerfile
        Env: EVENT_DB_HOST, IDM_HOST
        Healthcheck: /api/event-manager/health
    end note

    note right of UserSvc
        Build: ./User/user.dockerfile
        Env: USER_DB_URI, IDM_HOST
        Depends on: user-mongo, idm
    end note

    note right of IDM
        Build: ./IDM/idm.dockerfile
        Env: POSTGRES_HOST, REDIS_HOST
        Depends on: idm-postgres, redis
    end note
}

@enduml
