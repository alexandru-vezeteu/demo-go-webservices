@startuml service_communication
!define RECTANGLE class

skinparam componentStyle rectangle
skinparam linetype ortho

package "Client Layer" {
    [React Frontend\n:3000] as frontend
}

package "API Gateway Layer" {
    [IDM Gateway\n:8000\nPython/FastAPI] as idmgw
}

package "Service Layer" {
    [EventManager\n:12345\nGo/Gin] as eventmgr
    [User Service\n:12346\nGo/Gin] as usersvc
    [IDM Service\n:50051\nGo/gRPC] as idm
}

package "Data Layer" {
    database "PostgreSQL\nevent_db" as eventdb
    database "MongoDB\nuser_db" as userdb
    database "PostgreSQL\nidm_db" as idmdb
    database "Redis\nBlacklist" as redis
}

frontend --> eventmgr : HTTP REST\n/api/event-manager
frontend --> usersvc : HTTP REST\n/api/user-manager
frontend --> idmgw : HTTP REST\n/api/idm/auth

idmgw --> idm : gRPC\nLogin/Verify/Revoke

eventmgr --> idm : gRPC\nVerifyToken
usersvc --> idm : gRPC\nVerifyToken
usersvc --> eventmgr : HTTP\nService-to-Service

eventmgr --> eventdb : GORM
usersvc --> userdb : MongoDB Driver
idm --> idmdb : GORM
idm --> redis : Token Cache

note right of usersvc
  Service Authentication:
  serviciu_clienti account
  via ServiceAuthClient
  Token cached with 5min buffer
end note

note right of idm
  Central Auth Service
  JWT Token Management
  Token Blacklist
end note

@enduml
