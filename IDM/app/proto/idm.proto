syntax = "proto3";

package idm;

option go_package = "idmService/proto";

service IdentityService {
  rpc Login(LoginRequest) returns (LoginResponse);
  rpc VerifyToken(VerifyTokenRequest) returns (VerifyTokenResponse);
  rpc RevokeToken(RevokeTokenRequest) returns (RevokeTokenResponse);
}

message LoginRequest {
  string email = 1;    // User email address
  string password = 2; // User password
}

message LoginResponse {
  bool success = 1;
  string token = 2;  // JWT token in Base64Url format with claims: iss, sub, exp, jti, role
  string message = 3;
  string user_id = 4;  // User ID (corresponds to 'sub' claim in JWT)
  string role = 5;     // User role (corresponds to 'role' claim in JWT)
  string email = 6;    // User email address
}

message VerifyTokenRequest {
  string token = 1;  // JWT token to verify
}

message VerifyTokenResponse {
  bool valid = 1;      // false if expired or blacklisted, true if valid
  string email = 2;    // User email address
  string message = 3;  // Contains reason if invalid (expired, blacklisted, corrupted)
  string user_id = 4;  // User ID extracted from token's 'sub' claim (clear text)
  string role = 5;     // Role extracted from token's 'role' claim (clear text)
  string issuer = 6;   // Issuer extracted from token's 'iss' claim
  int64 expires_at = 7; // Expiration timestamp from token's 'exp' claim
  bool expired = 8;    // true if token has expired
  bool blacklisted = 9; // true if token is in blacklist
}

message RevokeTokenRequest {
  string token = 1;  // JWT token to revoke/destroy
}

message RevokeTokenResponse {
  bool success = 1;  // Always true (validation processing completed successfully)
  string message = 2; // Success message or reason for revocation
}
